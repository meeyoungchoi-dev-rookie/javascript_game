<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>숫자야구</title>
        <style>

        </style>
    </head>
    <body>
        <h1>숫자야구</h1>    
        <form method="post">
            <input type="text" placeholder="4자리 숫자를 입력하세요"/>
            <button type="submit">전송</button>
        </form>
        <div id="logs"></div>
        <div id="outs"></div>

        <script>
            const $form = document.querySelector("form");
            const $input = document.querySelector("input");
            const $logs = document.querySelector("#logs");
            
            let inputData = "";
            let arr = [];
            let comArr = [];
            let set = "";
            let comData = "";
            let arrData = "";
            let overStatus = true;
            let startStatus = true;
            let strikeCount = 0;
            let ballCount = 0;
            let outCount = 0;
            let innerHTML = "";
            const alreadyNum = [];

            const checkValue = (inputData) => {
               
                let status = "";
                if (inputData.length != 4) {
                    if (inputData.length < 4 || inputData.length > 4) {
                       return alert('숫자는 4자리여야 합니다.');
                       
                    } else {
                       return alert('4자리 숫자를 입력하세요');
                    }
                }

              
                // 중복된 값이 있는지 검사
                set = new Set(inputData);
                console.log('중복 제거전 길이: ' , inputData.length);
                console.log('중복 제거후 길이: ' , set.size);

                if (inputData.length !== set.size) {
                    return alert('중복된 값은 올수 없습니다.');    
                } 
                    
                 return true;
                
            }

            const comValue = () => {
              
           
               comArr = [];
                for (let i = 0; i < 4; i++) {
                    let randomNum = Math.floor(Math.random() * 9) + 1;

                    if (comArr.indexOf(randomNum) === -1) {
                        comArr.push(randomNum);
                    } else {
                       i--;
                    }                
                }
            }

            const gameStart = () => {
                // 게임 진행중
                strikeCount = 0;
                ballCount = 0;
                startStatus = false;
                overStatus = false;
                outCount = 0;
                
                alreadyNum.push(inputData);

                if(alreadyNum.length > 9) {
                    startStatus = true;
                    overStatus = true;
                    outCount = 0;
                    $logs.append("패배!! 정답: " + comArr.join("") , document.createElement("br"));
                    return;
                }
                    

                // 홈런
                if (comArr.join("") == inputData) {
                   
                    startStatus = true;
                    overStatus = true;
                    
                    outCount = 0;
                    let text = $logs.textContent;
                    text = " 나: " + inputData + " strike: " + strikeCount + " ball: " + ballCount + " outCount: " + outCount;
                
                    $logs.append(text , document.createElement("br"));
                    $logs.append("홈런 " , document.createElement("br"));
                    return;
                } 
  
                for (let i = 0; i < comArr.length; i++) {
                    let j = inputData.length - 1;
                    while (j <= inputData.length - 1 && j >= 0) {
                        console.log('j: ' + j);
                    
                        if (parseInt(comArr[i]) == parseInt(inputData[j]) && i == j) {
                            strikeCount = parseInt(strikeCount) + 1;
                            
                        } 
                        if (parseInt(comArr[i]) == parseInt(inputData[j]) && i != j) {
                            ballCount = parseInt(ballCount) + 1;
                            console.log("ball: " + ballCount);
                        }

                        j -= 1;
                    }
                    
                }

                if (strikeCount == 0 && ballCount == 0) {
                    console.log(outCount);
                    outCount = parseInt(outCount) + 1;
                    console.log(outCount);
                    
                 
                    if (outCount == 3) {
                        startStatus = true;
                        overStatus = true;
                        outCount = 0;
                        $logs.append("패배!! 3OUT!! 정답: " + comArr.join("") , document.createElement("br"));
                        return;
                    }
                }

                let text = $logs.textContent;
                text = " 나: " + inputData + " strike: " + strikeCount + " ball: " + ballCount + " outCount: " + outCount;
                
                $logs.append(text , document.createElement("br"));
                console.log('컴: ' + comArr.join("") + " 나: " + inputData + " strike: " + strikeCount + " ball: " + ballCount + " outCount: " + outCount  );
                $input.value = "";
            }

        

            const dataSubmit = (event) => {
                
                event.preventDefault();
                console.log('데이터: ' , $input.value);
               
                inputData = $input.value;
             
                if(!checkValue(inputData)) {
                    return;
                }

                if (overStatus == true && startStatus == true &&  checkValue(inputData)) {
                    comValue();
                   
                } 

                gameStart();
                
            }

            $form.addEventListener('submit' , dataSubmit);
        </script>
    </body>





</html>